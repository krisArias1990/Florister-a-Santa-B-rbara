<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <meta name="description" content="Florister√≠a Santa B√°rbara: arreglos florales para todas las ocasiones en Heredia, Costa Rica.">
  <title>Florister√≠a Santa B√°rbara</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <header>
    <div class="header-content">
      <img src="assets/logo.png" alt="Florister√≠a Santa B√°rbara" class="logo">
      <p class="tasa-cambio">Tasa de cambio: $1 = ‚Ç°504</p>
    </div>
    <nav>
      <ul id="menuCategorias"></ul>
    </nav>
  </header>

  <!-- Banner din√°mico -->
  <section class="carousel">
    <div class="carousel-inner" id="carousel-inner"></div>
    <div class="carousel-indicators" id="carousel-indicators"></div>
    <div class="carousel-controls">
      <button class="carousel-prev" onclick="showSlide(currentIndex - 1)">‚ùÆ</button>
      <button class="carousel-next" onclick="showSlide(currentIndex + 1)">‚ùØ</button>
    </div>
  </section>

  <main id="catalogo">
    <p style="text-align:center; padding:2rem; color:#888;">Cargando cat√°logo...</p>
  </main>

  <!-- Lightbox -->
  <div id="lightbox" class="lightbox" onclick="cerrarLightbox()">
    <img id="lightbox-img" src="" alt="Imagen del producto">
    <div class="lightbox-text">
      <h3 id="lightbox-nombre"></h3>
      <p id="lightbox-categoria"></p>
    </div>
  </div>

  <!-- Botones flotantes -->
  <a href="https://wa.me/50686053613" class="whatsapp-flotante" target="_blank">üí¨</a>
  <button class="btn-inicio" onclick="window.scrollTo({top: 0, behavior: 'smooth'})">‚Üë Inicio</button>

  <!-- Footer -->
  <footer>
    <div class="footer-content">
      <div class="footer-section">
        <h3>Cont√°ctenos</h3>
        <p>WhatsApp: <a href="https://wa.me/50686053613" target="_blank" style="color:#d1477a; text-decoration:underline;">8605-3613</a></p>
        <p><a href="https://www.google.com/maps?q=Santa+B√°rbara,+Heredia,+Costa+Rica" target="_blank" style="color:#d1477a; text-decoration:underline;">Santa B√°rbara, Heredia</a></p>
        <p style="font-size:0.85rem; margin-top:0.3rem;">
          <a href="https://waze.com/ul?q=Santa+B√°rbara,+Heredia,+Costa+Rica" target="_blank" style="color:#d1477a; margin-right:0.8rem;">Waze</a> |
          <a href="https://www.google.com/maps?q=Santa+B√°rbara,+Heredia,+Costa+Rica" target="_blank" style="color:#d1477a;">Google Maps</a>
        </p>
        <p>Horario: Lunes a S√°bado 8am-6pm</p>
      </div>
      <div class="footer-section">
        <h3>Acerca de</h3>
        <p>Florister√≠a Santa B√°rbara: m√°s de 10 a√±os creando momentos inolvidables.</p>
      </div>
      <div class="footer-section">
        <h3>Redes Sociales</h3>
        <p>Instagram: <a href="https://www.instagram.com/floristeriasantabarbara" target="_blank" style="color:#d1477a; text-decoration:underline;">@floristeriasantabarbara</a></p>
        <p>Facebook: <a href="https://www.facebook.com/FloristeriaSantaBarbara" target="_blank" style="color:#d1477a; text-decoration:underline;">Florister√≠a Santa B√°rbara</a></p>
        <p>TikTok: <a href="https://www.tiktok.com/@floristeriasantabarbara" target="_blank" style="color:#d1477a; text-decoration:underline;">@floristeriasantabarbara</a></p>
      </div>
      <div class="footer-section">
        <h3>Formas de Pago</h3>
        <p>SINPE M√≥vil</p>
        <p>Dat√°fono (todas las tarjetas)</p>
        <p>Link de pago</p>
        <p>Transferencia bancaria</p>
      </div>
    </div>
    <div class="footer-bottom">
      <p>¬© Florister√≠a Santa B√°rbara 2025</p>
    </div>
  </footer>

  <script>
    // === CONFIGURACI√ìN TEMPORADA ALTA ===
    const temporadasAltas = [
      { inicio: "2025-02-01", fin: "2025-02-15" },
      { inicio: "2025-05-01", fin: "2025-05-15" },
      { inicio: "2025-11-15", fin: "2025-12-31" }
    ];

    function enTemporadaAlta(hoy) {
      return temporadasAltas.some(t => hoy >= new Date(t.inicio) && hoy <= new Date(t.fin));
    }

    // === CARGA DE PRODUCTOS (JSON + LOCALSTORAGE FALLBACK) ===
    async function cargarProductos() {
      try {
        const response = await fetch('productos.json?_=' + Date.now());
        if (response.ok) return await response.json();
        throw new Error('No se pudo cargar productos.json');
      } catch (err) {
        console.warn('Usando localStorage como fallback:', err);
        const localData = localStorage.getItem('productosFloristeria');
        return localData ? JSON.parse(localData) : [];
      }
    }

    // === WHATSAPP CON MINIATURA + ENLACE A CATEGOR√çA ===
    function generarPedido(producto, precioMostrado) {
      const categoriaId = encodeURIComponent(producto.categoria);
      const enlaceCatalogo = `https://krisarias1990.github.io/Florister-a-Santa-B-rbara/#${categoriaId}`;
      const fotoThumb = producto.foto_thumb || producto.foto_full || producto.foto;

      const mensaje = `
¬°Hola! Quisiera pedir:

*Producto:* ${producto.nombre}
*Categor√≠a:* ${producto.categoria}
*Precio:* ‚Ç°${precioMostrado.toLocaleString()}
*Fecha:* ${new Date().toLocaleDateString('es-CR')}

[${fotoThumb}](${enlaceCatalogo})

*Descripci√≥n:* ${producto.descripcion || '‚Äî'}

[Ver en cat√°logo ‚Üí](${enlaceCatalogo})

Por favor confirmar disponibilidad.
Gracias

‚Äî Florister√≠a Santa B√°rbara`.trim();

      const numero = '50686053613';
      const url = `https://wa.me/${numero}?text=${encodeURIComponent(mensaje)}`;

      if (/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)) {
        window.open(url, '_blank');
      } else {
        navigator.clipboard?.writeText(mensaje).then(() => {
          alert('Mensaje copiado. P√©galo en WhatsApp Web.\n\nLa imagen aparecer√° peque√±a y al hacer clic ir√° al cat√°logo.');
        }).catch(() => {
          prompt('Copia y pega en WhatsApp:', mensaje);
        });
      }
    }

    // === LIGHTBOX ===
    function abrirLightbox(producto) {
      document.getElementById('lightbox-img').src = producto.foto_full || producto.foto;
      document.getElementById('lightbox-nombre').textContent = producto.nombre;
      document.getElementById('lightbox-categoria').textContent = producto.categoria;
      document.getElementById('lightbox').classList.add('active');
      document.body.style.overflow = 'hidden';
    }

    function cerrarLightbox() {
      document.getElementById('lightbox').classList.remove('active');
      document.body.style.overflow = '';
    }

    // === CARRUSEL (SIN CAMBIOS) ===
    let currentIndex = 0;
    let autoSlideInterval;

    const banners = [
      { img: "https://raw.githubusercontent.com/krisArias1990/Florister-a-Santa-B-rbara/main/flores/amor-y-amistad/full/IMG_5816.jpeg", category: "Amor y Amistad" },
      { img: "https://raw.githubusercontent.com/krisArias1990/Florister-a-Santa-B-rbara/main/flores/arreglos/full/IMG_5825.jpeg", category: "D√≠a de la Madre" },
      { img: "https://raw.githubusercontent.com/krisArias1990/Florister-a-Santa-B-rbara/main/flores/Baby%20shower/full/IMG_5817.jpeg", category: "Baby Shower" },
      { img: "https://raw.githubusercontent.com/krisArias1990/Florister-a-Santa-B-rbara/main/flores/bodas/full/BODAS.jpg", category: "Bodas" },
      { img: "https://raw.githubusercontent.com/krisArias1990/Florister-a-Santa-B-rbara/main/flores/Arreglos%20Premium/full/50.png", category: "Arreglos Premium" }
    ];

    function renderCarousel() {
      const inner = document.getElementById('carousel-inner');
      const indicators = document.getElementById('carousel-indicators');

      inner.innerHTML = banners.map((b, i) => `
        <a href="#${encodeURIComponent(b.category)}" class="carousel-link">
          <div class="carousel-item">
            <img src="${b.img}" alt="${b.category}" loading="lazy">
            <div class="carousel-caption">
              <h3>${b.category}</h3>
              <p class="contacto-banner">WhatsApp: 8605-3613</p>
            </div>
          </div>
        </a>
      `).join('');

      indicators.innerHTML = banners.map((_, i) => `
        <span data-index="${i}" ${i === 0 ? 'class="active"' : ''}></span>
      `).join('');

      indicators.querySelectorAll('span').forEach(dot => {
        dot.addEventListener('click', () => goToSlide(parseInt(dot.dataset.index)));
      });

      showSlide(0);
    }

    function showSlide(index) {
      const inner = document.getElementById('carousel-inner');
      const dots = document.querySelectorAll('.carousel-indicators span');
      const total = dots.length;

      if (index >= total) index = 0;
      if (index < 0) index = total - 1;

      currentIndex = index;
      inner.style.transform = `translateX(-${index * 100}%)`;
      dots.forEach((dot, i) => dot.classList.toggle('active', i === index));
    }

    function goToSlide(index) {
      stopAutoSlide();
      showSlide(index);
      startAutoSlide();
    }

    function startAutoSlide() {
      autoSlideInterval = setInterval(() => showSlide(currentIndex + 1), 5000);
    }

    function stopAutoSlide() {
      clearInterval(autoSlideInterval);
    }

    // === CAT√ÅLOGO CORREGIDO (SIN ONCLICK INLINE) ===
    async function renderCatalogo() {
      try {
        const productos = await cargarProductos();
        if (productos.length === 0) {
          document.getElementById('catalogo').innerHTML = '<p style="text-align:center; padding:2rem; color:#888;">No hay productos disponibles.</p>';
          return;
        }

        const hoy = new Date();
        const esAlta = enTemporadaAlta(hoy);

        const categoriasUnicas = [...new Set(productos.map(p => p.categoria))];
        const menu = document.getElementById('menuCategorias');
        menu.innerHTML = categoriasUnicas.map(cat => `<li><a href="#${encodeURIComponent(cat)}">${cat}</a></li>`).join('');

        const grupos = {};
        productos.forEach(p => {
          if (!grupos[p.categoria]) grupos[p.categoria] = [];
          grupos[p.categoria].push(p);
        });

        const catalogo = document.getElementById('catalogo');
        catalogo.innerHTML = Object.entries(grupos).map(([cat, prods]) => `
          <section class="categoria" id="${encodeURIComponent(cat)}">
            <h2>${cat}</h2>
            <div class="productos">
              ${prods.map(p => {
                const precio = esAlta ? p.precioAlta : p.precioBaja;
                const fotoThumb = p.foto_thumb || p.foto_full || p.foto || 'https://via.placeholder.com/240x180/f9f0f4/d1477a?text=Sin+Foto';
                const fotoFull = p.foto_full || p.foto || fotoThumb;
                const productoData = JSON.stringify({ ...p, foto_full: fotoFull }).replace(/"/g, '&quot;');
                return `
                  <div class="producto">
                    <img src="${fotoThumb}" alt="${p.nombre}" class="producto-img" data-product='${productoData}' loading="lazy">
                    <h3>${p.nombre}</h3>
                    <p class="descripcion">${p.descripcion || ''}</p>
                    <p class="precio">‚Ç°${precio.toLocaleString()}</p>
                    <button class="btn-pedir" data-product='${productoData}' data-precio='${precio}'>
                      Enviar por WhatsApp
                    </button>
                  </div>
                `;
              }).join('')}
            </div>
          </section>
        `).join('');

        // EVENTOS DELEGADOS (CORREGIDO)
        document.addEventListener('click', function(e) {
          if (e.target.classList.contains('producto-img')) {
            const productStr = e.target.getAttribute('data-product');
            if (productStr) {
              try {
                const producto = JSON.parse(productStr.replace(/&quot;/g, '"'));
                abrirLightbox(producto);
              } catch (err) {
                console.error('Error al abrir lightbox:', err);
              }
            }
          } else if (e.target.classList.contains('btn-pedir')) {
            const productStr = e.target.getAttribute('data-product');
            const precio = parseFloat(e.target.getAttribute('data-precio'));
            if (productStr && !isNaN(precio)) {
              try {
                const producto = JSON.parse(productStr.replace(/&quot;/g, '"'));
                generarPedido(producto, precio);
              } catch (err) {
                console.error('Error al generar pedido:', err);
              }
            }
          }
        });

      } catch (err) {
        document.getElementById('catalogo').innerHTML = '<p style="text-align:center; color:red; padding:2rem;">Error al cargar el cat√°logo. Intenta recargar la p√°gina.</p>';
        console.error('Error en renderCatalogo:', err);
      }
    }

    // === INICIO ===
    document.addEventListener('DOMContentLoaded', () => {
      renderCarousel();
      renderCatalogo();
      startAutoSlide();

      const carousel = document.querySelector('.carousel');
      if (carousel) {
        carousel.addEventListener('mouseenter', stopAutoSlide);
        carousel.addEventListener('mouseleave', startAutoSlide);
      }
    });
  </script>
</body>
</html>
