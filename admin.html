<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Florister√≠a Santa B√°rbara</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <header>
    <div class="header-content">
      <img src="assets/logo.png" alt="Florister√≠a Santa B√°rbara" class="logo">
      <h1>üåπ Florister√≠a Santa B√°rbara</h1>
      <p class="tasa-cambio">üí± Tasa de cambio: $1 = ‚Ç°504 (referencia)</p>
    </div>
    <nav>
      <ul id="menuCategorias"></ul>
    </nav>
  </header>

  <main id="catalogo">
    <p style="text-align:center; padding:2rem; color:#888;">Cargando cat√°logo...</p>
  </main>

  <!-- Banner promocional con transici√≥n autom√°tica -->
  <section class="carousel">
    <div class="carousel-inner" id="carousel-inner">
      <!-- Se llenar√° din√°micamente -->
    </div>
  </section>

  <!-- Lightbox -->
  <div id="lightbox" class="lightbox" onclick="cerrarLightbox()">
    <div class="lightbox-content">
      <button class="lightbox-btn prev" onclick="cambiarImagen(-1)">‚ùÆ</button>
      <div class="lightbox-info">
        <h3 id="lightbox-nombre">Nombre</h3>
        <p id="lightbox-descripcion">Descripci√≥n</p>
        <p id="lightbox-precio">Precio</p>
        <p class="tasa-producto">Tasa de Cambio: $1 = ‚Ç°504</p>
        <p class="contacto-producto">Cont√°ctenos: WP: 8605-3613</p>
      </div>
      <img id="lightbox-img" src="">
      <button class="lightbox-btn next" onclick="cambiarImagen(1)">‚ùØ</button>
    </div>
  </div>

  <!-- Botones flotantes -->
  <a href="https://wa.me/50686053613" class="whatsapp-flotante" target="_blank">üí¨</a>
  <button class="btn-inicio" onclick="window.scrollTo({top: 0, behavior: 'smooth'})">‚Üë Inicio</button>

  <!-- Pie de p√°gina -->
  <footer>
    <div class="footer-content">
      <div class="footer-section">
        <h3>Cont√°ctenos</h3>
        <p>üì± WhatsApp: 8605-3613</p>
        <p>üìç Santa B√°rbara, Heredia</p>
        <p>üïí Horario: Lunes a S√°bado 8am-6pm</p>
      </div>
      <div class="footer-section">
        <h3>Acerca de</h3>
        <p>Florister√≠a Santa B√°rbara: m√°s de 10 a√±os creando momentos inolvidables.</p>
      </div>
      <div class="footer-section">
        <h3>Redes Sociales</h3>
        <p>üì∏ Instagram: @floristeriasantabarbara</p>
        <p>üìò Facebook: Florister√≠a Santa B√°rbara</p>
      </div>
    </div>
    <div class="footer-bottom">
      <p>¬© Florister√≠a Santa B√°rbara 2025</p>
    </div>
  </footer>

  <script>
    // Temporadas altas
    const temporadasAltas = [
      { inicio: "2025-02-01", fin: "2025-02-15" },
      { inicio: "2025-05-01", fin: "2025-05-15" },
      { inicio: "2025-11-15", fin: "2025-12-31" }
    ];

    function enTemporadaAlta(hoy) {
      return temporadasAltas.some(t => {
        const ini = new Date(t.inicio);
        const fin = new Date(t.fin);
        return hoy >= ini && hoy <= fin;
      });
    }

    // WhatsApp
    function generarPedido(producto, precioMostrado) {
      const urlImagen = producto.foto && producto.foto.startsWith('http') 
        ? `\n[Ver imagen del arreglo](${producto.foto.trim()})\n` 
        : '\n*(Foto del arreglo disponible en el cat√°logo)*\n';

      const mensaje = 
`¬°Hola! Quisiera pedir el siguiente arreglo:

Producto: ${producto.nombre}
Categor√≠a: ${producto.categoria}
Precio: ‚Ç°${precioMostrado.toLocaleString()}
Fecha: ${new Date().toLocaleDateString('es-CR', { day: '2-digit', month: '2-digit', year: 'numeric' })}

Descripci√≥n: ${producto.descripcion || '‚Äî'}${urlImagen}

Por favor, confirmar disponibilidad.
Gracias üåπ

Cat√°logo: https://krisarias1990.github.io/Florister-a-Santa-B-rbara  

‚Äî Enviado desde Florister√≠a Santa B√°rbara`;

      const urlWhatsApp = `https://wa.me/50686053613?text=${encodeURIComponent(mensaje)}`;
      const esMovil = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
      if (esMovil) {
        window.open(urlWhatsApp, '_blank');
      } else {
        if (navigator.clipboard) {
          navigator.clipboard.writeText(mensaje).then(() => {
            if (confirm('‚úÖ Mensaje copiado.\n\n¬øAbrir WhatsApp Web?')) {
              window.open(urlWhatsApp, '_blank');
            }
          }).catch(() => {
            alert('üìã Copia este mensaje y env√≠alo por WhatsApp:\n\n' + mensaje);
          });
        } else {
          const textarea = document.createElement('textarea');
          textarea.value = mensaje;
          textarea.style.position = 'fixed';
          textarea.style.opacity = '0';
          document.body.appendChild(textarea);
          textarea.select();
          document.execCommand('copy');
          document.body.removeChild(textarea);
          if (confirm('üìã Mensaje copiado.\n\n¬øAbrir WhatsApp Web?')) {
            window.open(urlWhatsApp, '_blank');
          }
        }
      }
    }

    // Lightbox
    let currentProduct = null;
    let currentIndex = 0;

    function abrirLightbox(producto) {
      currentProduct = producto;
      currentIndex = 0;
      actualizarLightbox();
      document.getElementById('lightbox').classList.add('active');
      document.body.style.overflow = 'hidden';
    }

    function actualizarLightbox() {
      const fotos = currentProduct.fotos || [currentProduct.foto];
      const fotoActual = fotos[currentIndex] || fotos[0];
      const precioActual = enTemporadaAlta(new Date()) ? currentProduct.precioAlta : currentProduct.precioBaja;
      document.getElementById('lightbox-img').src = fotoActual;
      document.getElementById('lightbox-nombre').textContent = currentProduct.nombre;
      document.getElementById('lightbox-descripcion').textContent = currentProduct.descripcion || '';
      document.getElementById('lightbox-precio').textContent = `‚Ç°${precioActual.toLocaleString()} IVA incl.`;
    }

    function cambiarImagen(direccion) {
      const fotos = currentProduct.fotos || [currentProduct.foto];
      currentIndex += direccion;
      if (currentIndex < 0) currentIndex = fotos.length - 1;
      if (currentIndex >= fotos.length) currentIndex = 0;
      actualizarLightbox();
    }

    function cerrarLightbox() {
      document.getElementById('lightbox').classList.remove('active');
      document.body.style.overflow = '';
    }

    // Banner promocional
    const banners = [
      {
        img: "https://via.placeholder.com/800x300/f9f0f4/d1477a?text=San+Valent√≠n",
        title: "San Valent√≠n",
        subtitle: "¬°Incluye barra de chocolate y florero!"
      },
      {
        img: "https://via.placeholder.com/800x300/2ecc71/d1477a?text=D√≠a+de+la+Madre",
        title: "D√≠a de la Madre",
        subtitle: "Arreglos √∫nicos para la mujer m√°s importante"
      },
      {
        img: "https://via.placeholder.com/800x300/3498db/d1477a?text=Navidad",
        title: "Navidad",
        subtitle: "Decoraci√≥n navide√±a hecha con amor"
      }
    ];

    let currentBanner = 0;
    function renderCarousel() {
      const inner = document.getElementById('carousel-inner');
      inner.innerHTML = banners.map(b => `
        <div class="carousel-item">
          <img src="${b.img}" alt="${b.title}">
          <div class="carousel-caption">
            <h3>${b.title}</h3>
            <p>${b.subtitle}</p>
            <p class="contacto-banner">Cont√°ctenos: WP: 8605-3613</p>
          </div>
        </div>
      `).join('');
    }

    function rotateBanner() {
      const items = document.querySelectorAll('.carousel-item');
      if (items.length === 0) return;
      items.forEach(item => item.classList.remove('active'));
      currentBanner = (currentBanner + 1) % banners.length;
      items[currentBanner].classList.add('active');
    }

    // Cat√°logo
    async function renderCatalogo() {
      try {
        const response = await fetch('productos.json?_=' + Date.now());
        const productos = await response.json();
        const categoriasBloqueadas = JSON.parse(localStorage.getItem('categoriasBloqueadas') || '[]');
        const productosVisibles = productos.filter(p => 
          p.disponible !== false && !categoriasBloqueadas.includes(p.categoria)
        );

        const categoriasUnicas = [...new Set(productosVisibles.map(p => p.categoria))];
        const menu = document.getElementById('menuCategorias');
        const catalogo = document.getElementById('catalogo');

        menu.innerHTML = categoriasUnicas.map(cat => 
          `<li><a href="#${encodeURIComponent(cat)}">${cat}</a></li>`
        ).join('');

        const grupos = {};
        productosVisibles.forEach(p => {
          if (!grupos[p.categoria]) grupos[p.categoria] = [];
          grupos[p.categoria].push(p);
        });

        catalogo.innerHTML = Object.entries(grupos).map(([cat, prods]) => `
          <section class="categoria" id="${encodeURIComponent(cat)}">
            <h2>${cat}</h2>
            <div class="productos">
              ${prods.map(p => {
                const precioActual = enTemporadaAlta(new Date()) ? p.precioAlta : p.precioBaja;
                const fotoUrl = p.foto?.trim() || 'https://via.placeholder.com/240x180/f9f0f4/d1477a?text=Sin+Foto';
                return `
                  <div class="producto">
                    <img src="${fotoUrl}" alt="${p.nombre}" 
                         data-product='${JSON.stringify(p).replace(/'/g, "&#39;").replace(/"/g, "&quot;")}' 
                         class="producto-img">
                    <h3>${p.nombre}</h3>
                    <p class="descripcion">${p.descripcion || ''}</p>
                    <p class="precio">‚Ç°${precioActual.toLocaleString()} IVA incl.</p>
                    <p class="tasa-producto">Tasa de Cambio: $1 = ‚Ç°504</p>
                    <p class="contacto-producto">Cont√°ctenos: WP: 8605-3613</p>
                    <button class="btn-pedir" onclick='generarPedido(${JSON.stringify(p).replace(/'/g, "\\'")}, ${precioActual})'>
                      üì© Enviar pedido por WhatsApp
                    </button>
                  </div>
                `;
              }).join('')}
            </div>
          </section>
        `).join('') || '<p style="text-align:center; padding:2rem; color:#888;">No hay productos disponibles.</p>';
      } catch (err) {
        document.getElementById('catalogo').innerHTML = '<p style="text-align:center; padding:2rem; color:red;">Error al cargar el cat√°logo.</p>';
        console.error(err);
      }
    }

    // Event listener lightbox
    document.addEventListener('click', function(e) {
      if (e.target.classList.contains('producto-img')) {
        const productStr = e.target.getAttribute('data-product');
        if (productStr) {
          try {
            const producto = JSON.parse(
              productStr.replace(/&#39;/g, "'").replace(/&quot;/g, '"')
            );
            if (producto.foto) producto.foto = producto.foto.trim();
            abrirLightbox(producto);
          } catch (err) {
            console.error('Error al abrir lightbox:', err);
            alert('No se pudo cargar la imagen. Int√©ntalo de nuevo.');
          }
        }
      }
    });

    // Inicializar
    document.addEventListener('DOMContentLoaded', () => {
      renderCarousel();
      renderCatalogo();
      setInterval(rotateBanner, 5000); // Cambia cada 5 segundos
      // Activar el primer banner
      setTimeout(() => {
        if (document.querySelector('.carousel-item')) {
          document.querySelector('.carousel-item').classList.add('active');
        }
      }, 100);
    });
  </script>
</body>
</html>
